AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: '
  Example(s) of lambda(s)
  - responding to HTTP requests
  '

Parameters:
    # More info about Parameters: # https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html
    StackEnv:
        Type: String
        Default: Dev001
        Description: Stack prefix/suffix to make resource names unique in the Tii eco-system per environment.

Globals:
    # More info about Globals: https://github.com/awslabs/serverless-application-model/blob/master/docs/globals.rst
    Function:
        MemorySize: 1536
        Runtime: java11
        Timeout: 30
    Api:
        Cors:
            AllowMethods: "'GET,PUT,POST,DELETE,OPTIONS'"
            AllowHeaders: "'Content-Type,X-Amz-Date,Authorization,X-Api-Key'"
            AllowOrigin: "'*'"
            AllowCredentials: "'*'"

Resources:
    ServerlessV1DemoApi:
        Type: AWS::Serverless::Api
        Properties:
            StageName: !Ref StackEnv
            EndpointConfiguration:
                Type: REGIONAL
    ServerlessV1DemoFunction:
        # More info about Function Resource: https://github.com/awslabs/serverless-application-model/blob/master/versions/2016-10-31.md#awsserverlessfunction
        Type: AWS::Serverless::Function
        Properties:
            CodeUri: .
            Handler: com.turnitin.serverlessv1demo.api.ServerlessV1DemoGet
            Events:
                ServerlessV1DemoHelloApi:
                    Type: Api
                    Properties:
                        RestApiId: !Ref ServerlessV1DemoApi
                        Path: /hello/{who}
                        Method: GET
Outputs:
    # https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/outputs-section-structure.html
    ServerlessV1DemoApiRootURL:
        Description: API Gateway root URL for ServerlessV1Demo API
        Value: !Sub "https://${ServerlessV1DemoApi}.execute-api.${AWS::Region}.amazonaws.com/${StackEnv}"

# Metadata:
    # https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/metadata-section-structure.html
# Mappings:
    # https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/mappings-section-structure.html
# Conditions:
    # https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/conditions-section-structure.html
